---
title: "hw3"
author: "Ruwen Zhou"
date: "10/8/2020"
output: github_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(rnoaa)
library(ggridges)
library(patchwork)

library(p8105.datasets)
knitr::opts_chunk$set(
	fig.width = 6, 
  fig.asp = .6,
  out.width = "90%"
)
theme_set(theme_minimal() + theme(legend.position = "bottom"))
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)
scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

### Problem 1

```{r}
data("instacart")
```

This dataset contains `r nrow(instacart)` rows and `r ncol(instacart)` columns. 

Observations are the level of items in orders by user. There are user / order variables -- user ID, order ID, order day, and order hour. There are also item variables -- name, aisle, department, and some numeric codes. 

How many aisles, and which are most items from?

```{r}
instacart %>% 
	count(aisle) %>% 
	arrange(desc(n))
```

doc plot
```{r}
instacart %>% 
	count(aisle) %>% 
	filter(n > 10000) %>% 
	mutate(
		aisle = factor(aisle),
		aisle = fct_reorder(aisle, n)
	) %>% 
	ggplot(aes(x = aisle, y = n)) + 
	geom_point() + 
	theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))
```

plot table

```{r}
instacart %>% 
	filter(aisle %in% c("baking ingredients", "dog food care", "packaged vegetables fruits")) %>% 
	group_by(aisle) %>% 
	count(product_name) %>% 
	mutate(rank = min_rank(desc(n))) %>% 
	filter(rank < 4) %>% 
	arrange(aisle, rank) %>% 
	knitr::kable()
```

apple vs ice cream

```{r}
instacart %>% 
	filter(product_name %in% c("Pink Lady Apples", "Coffee Ice Cream")) %>% 
	group_by(product_name, order_dow) %>% 
	summarize(mean_hour = mean(order_hour_of_day)) %>% 
	pivot_wider(
		names_from = order_dow,
		values_from = mean_hour
	)
```

# Problem 2

##Load and clean data

```{r}
accel = 
  read_csv("./data/accel_data.csv") %>% 
  janitor::clean_names() %>%
  pivot_longer(
    activity_1:activity_1440,
    names_to = "minute",
    names_prefix = "activity_",
    values_to = "number_of_activity") %>% 
  drop_na("number_of_activity") %>% 
  mutate(
    minute = as.numeric(minute),
    number_of_activity = as.numeric(number_of_activity),
    week = as.character(week),
    day = as.factor(day),
    day_id = as.factor(day_id) 
  ) %>% 
  mutate(weekend = day %in% c("Sunday","Saturday"),
         weekday = day %in% c("Monday","Tuesday", "Wednesday","Thursday","Friday"),
         weekend_vs_weekday=
           case_when(weekend ~"weekend",
                     weekday ~ "weekday")) %>% 
  mutate(weekend_vs_weekday = as.factor(weekend_vs_weekday),
         day = forcats::fct_relevel(day,c("Monday","Tuesday","Wednesday","Thursday",
                                     "Friday", "Saturday","Sunday"))) %>% 
  group_by(week,day) %>% 
  arrange(day,.by_group = T) %>% 
  relocate(day_id, week, weekend_vs_weekday)

accel
```
First, we read data from "accel_data.csv" and clean it. Since the data in the excel is in a format that hard to read, I used pivot_longer and count the number of activities of different time length. And then drop null values and mutate the format of some variables for calculation. Then we create weekend_vs_weekday column. The last step is to group, relocate the data and make it more readable. Finally, this dataset has `r nrow(accel)` rows and `r ncol(accel)` columns, with variables day_id, week, weekend_vs_weekday, day, minute, number_of_activity, weekend, weekday.

## Traditinal analysis
```{r}
accel %>% 
  summarize(total_activity = sum(number_of_activity)) %>% 
  pivot_wider(names_from = week,
              values_from = total_activity,
              names_prefix = "week") %>% 
  knitr::kable()
```
Trend: People are having significantly less activity on Saturday, especially on week 4 and week 5.

## Single-panel plot that shows the 24-hour activity time courses for each day and use color to indicate day of the week.
```{r}
accel
```
```{r}
accel %>% 
  group_by(day_id,day,minute) %>% 
  summarize(total_activity = sum(number_of_activity)) %>%
  ggplot(aes(x = minute, y = total_activity, color = day)) +
  geom_smooth(se = FALSE) +
  labs(
    title = "24-hour activity time counts for each day"
    )+
  scale_y_continuous(trans = "sqrt",
                     name = "Activities",
                     breaks = c(50,100,150,200,250,300,350,400))+
  scale_x_continuous(name = "Hour",
                     breaks = c(60,120,180, 240,300, 360,420, 480,540, 600,660, 720,780, 840,900, 960,1020, 1080,1140, 1200,1260, 1320,1380, 1440),
                     labels = c(1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24))
  
```
Based on this graph, we can see that everyday, activities usually start increasing form 6am. And until around 10am, it reaches its peak. The amount of activity done on evening is usually larger than on the afternoon. On Friday, there is a peak time at 9pm.

























